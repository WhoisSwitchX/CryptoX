// Import Ethers.js
// Ensure Ethers.js script is included in the HTML
// <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.0/dist/ethers.umd.min.js"></script>

async function deriveAddressFromPrivateKey() {
    const privateKey = document.getElementById('privateKey').value;

    try {
        // Derive Ethereum address from private key using ethers.js
        const wallet = new ethers.Wallet(privateKey);
        document.getElementById('addressDisplay').innerText = wallet.address;
        document.getElementById('privateKeyDisplay').innerText = privateKey;

        // Set Etherscan link
        const etherscanLink = `https://etherscan.io/address/${wallet.address}`;
        document.getElementById('etherscanLink').href = etherscanLink;
        document.getElementById('etherscanLink').style.display = 'inline';

        // Fetch balance
        await fetchBalance(wallet.address, 'balanceDisplay');
    } catch (error) {
        document.getElementById('message').innerText = 'Invalid Private Key!';
        console.error(error);
    }
}

async function generateRandomPrivateKeyAndAddress() {
    // Generate random wallet using ethers.js
    const randomWallet = ethers.Wallet.createRandom();

    // Display generated address and private key
    document.getElementById('randomAddressDisplay').innerText = randomWallet.address;
    document.getElementById('randomPrivateKeyDisplay').innerText = randomWallet.privateKey;

    // Set Etherscan link
    const randomEtherscanLink = `https://etherscan.io/address/${randomWallet.address}`;
    document.getElementById('randomEtherscanLink').href = randomEtherscanLink;
    document.getElementById('randomEtherscanLink').style.display = 'inline';

    // Fetch balance
    await fetchBalance(randomWallet.address, 'randomBalanceDisplay');
}

// Fetch Ethereum balance using ethers.js
async function fetchBalance(address, displayElementId) {
    try {
        // Connect to Ethereum mainnet via Ethers.js default provider
        const provider = new ethers.providers.getDefaultProvider('mainnet');

        // Fetch the balance in wei and convert it to Ether
        const balance = await provider.getBalance(address);
        const balanceInEth = ethers.utils.formatEther(balance);

        document.getElementById(displayElementId).innerText = `${balanceInEth} ETH`;
    } catch (error) {
        console.error('Error fetching balance:', error);
        document.getElementById(displayElementId).innerText = 'Error fetching balance';
    }
}